{% extends "base.twig" %}

{% block title %}Catalogue des offres - Lebonplan{% endblock %}

{% block content %}
    {% if permLVL == 2 %}
        <a href="{{ path('add-offer') }}" class="btn-add">‚ûï Ajouter une offre</a>
    {% endif %}

    <div>
        <h1 class="center">Postuler √† nos offres disponibles</h1>
    </div>

    {% if successMessage is defined %}
        <div class="alertt alertt-success">{{ successMessage }}</div>
    {% endif %}
    {% if errorMessage is defined %}
        <div class="alertt alertt-danger">{{ errorMessage }}</div>
    {% endif %}

    <div class="search-container">
        <form action="{{ path('offres') }}" method="GET" class="search-form">
            <input type="hidden" name="page" value="offres">
            <div class="search-wrapper">
                <input 
                    type="text" 
                    name="recherche" 
                    placeholder="Rechercher une offre par mot-cl√©, entreprise ou lieu..." 
                    class="search-input"
                    value="{{ searchTerm|default('') }}"
                >

                {% if searchTerm %}
                    <a href="?page=offres" class="clear-search">√ó</a>
                {% endif %}
                <button type="submit" class="search-button">
                    <p>üîé</p>
                </button>
            </div>
        </form>
    </div>




    <div class="offers">
        {% for offre in Offer %}
            <div class="offer hoverable">
                <div style="text-align: right;">
                    <a href="?page=toggle-wishlist&id={{ offre.idOffer }}" title="{% if offre.isFavorite %}Retirer des favoris{% else %}Ajouter aux favoris{% endif %}">
                        <span class="wishlist-heart {% if offre.isFavorite %}active{% endif %}">
                            {% if offre.isFavorite %}
                                ‚ô•
                            {% else %}
                                ‚ô°
                            {% endif %}
                        </span>
                    </a>
                </div>

                    <h1 class="title center">{{ offre.NameOffer }}</h1>
                    <h2 class="small center">{{ offre.DescOffer }} | {{ offre.RemunOffer }} </h2>
                    <h2 class="small center">{{ offre.NameCompany}} | Publi√©e le {{ offre.DateOffer|date("d/m/Y") }}</h2>
                    <h1 class="center">
                        <a href="?page=postuler&id={{ offre.idOffer }}" class="postuler clickable"> POSTULER </a>
                    </h1>

                {% if permLVL == 2 %}
                    <a href="{{ path('edit-offer') }}&id={{ offre.idOffer }}" class="btn-edit">‚úèÔ∏è Modifier</a>
                    <a href="{{ path('delete-offer') }}&id={{ offre.idOffer }}" class="btn-delete">üóëÔ∏è Supprimer</a>
                {% endif %}
            </div>
        {% else %}
            <p class="center">Aucune offre disponible pour le moment.</p>
        {% endfor %}
    </div>

    <div class="pagination">
        {% if currentPage > 1 %}
            <a href="?page=offres&pagination=1{% if searchTerm %}&recherche={{ searchTerm|url_encode }}{% endif %}" class="btn-first"><<</a>
            <a href="?page=offres&pagination={{ currentPage - 1 }}{% if searchTerm %}&recherche={{ searchTerm|url_encode }}{% endif %}"><</a>
        {% endif %}

        <span>Page {{ currentPage }} / {{ totalPages }}</span>

        {% if currentPage < totalPages %}
            <a href="?page=offres&pagination={{ currentPage + 1 }}{% if searchTerm %}&recherche={{ searchTerm|url_encode }}{% endif %}">></a>
            <a href="?page=offres&pagination={{ totalPages }}{% if searchTerm %}&recherche={{ searchTerm|url_encode }}{% endif %}" class="btn-last">>></a>
        {% endif %}
    </div>
{% endblock %}
